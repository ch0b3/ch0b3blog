---
title: "ドメイン駆動設計 モデリング/実践ガイド 備忘録②"
date: 2022-06-11T23:29:50+09:00
draft: true
---

# 第二章　モデリングから実装まで

## ドメインモデリング

### ユースケース図

UMLで定義されている「ユーザーの要求に対してシステムの振る舞いを定義する図」  
アクターが「〇〇を✕✕する」という形式で記述する。  
この中でドメインモデリング図の作成スコープを決めていく。

### なぜユースケース図をまず作成するのか。

ユースケースがわからないとどのようなモデルを作成すればいいかわからないから。  
「作業者として自分のタスクを管理したい」のか「管理者として、複数管理者のタスクを管理したい」のか。  
それによって、「タスク」のドメインモデルは違うものになる。  

### ドメインモデリング図作成スコープを決める目的

なぜ一度定義したユースケース図の中でドメインモデル図作成のスコープを決めるのか。   
ドメインモデル図を作成していると色々な要素が浮かんできて、議論が広がってしまう。  
それを範囲を狭めることで限られた時間内で成果を出せるようにするため。  

### ドメインモデル図

- メソッドは書かず、オブジェクトの属性を書く
- ルール/制約を吹き出しに書く
- オブジェクト同士の関連を示す
- 多重度を定義
- 集約の範囲を定義
- 理解を促進するために、具体例などを書いても良い

### ルール/制約の記述方法

基本的には吹き出しに箇条書きでOK。  
状態遷移もルール/制約の一つと捉えることができるので、状態遷移図を書くのも有効。  

## ドメインモデルの実装

### ドメインモデル貧血症の問題点

- 不整合なデータをいくらでも作ることができてしまう
- 仕様を追いかけるのに、多くのクラスをコード参照から追う必要がある

### ドメイン知識を表現した実装

ドメイン知識をドメイン層に委譲する。  

- コンストラクタでインスタンス生成時の状態を定義する
- ルール/制約をドメイン層に記述する
- ユースケース層ではどのように実装するか(How)は隠蔽され、何をしたいか(What)だけ書く

### 常に正しいインスタンスしか存在させないドメイン層オブジェクト設計の基本方針

どのタイミングで永続化してもデータの整合性が保証されるようにする。  

- 生成条件の強制
  - コンストラクタまたはファクトリーメソッドを経由して生成する

- ミューテーション条件の強制
  - セッターは外部公開しない
  - 正しいミューテーションを起こすメソッドのみ外部公開する

## Q&A

### ユビキタス言語の管理方法

- ドメインモデル図を電子化し、そこにユビキタス言語を定義していく
  - おすすめツールは(PlantUML)[https://plantuml.com/ja/starting]
    - Git管理できる
  - ビジネスサイドやステークホルダーに浸透させるにはユビキタス言語を画面に反映すると良い
